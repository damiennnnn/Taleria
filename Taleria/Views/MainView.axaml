<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Taleria.ViewModels"
             xmlns:rest="using:RestSharp"
             xmlns:semi="clr-namespace:Semi.Avalonia;assembly=Semi.Avalonia"
             xmlns:avaloniaEdit="clr-namespace:AvaloniaEdit;assembly=AvaloniaEdit"
             xmlns:system="clr-namespace:System;assembly=netstandard"
             xmlns:views="clr-namespace:Taleria.Views"
             xmlns:controls="clr-namespace:Taleria.Controls"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="Taleria.Views.MainView"
             x:DataType="vm:MainViewModel">
    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
         to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainViewModel />
    </Design.DataContext>

    <UserControl.ContentTemplate>

    </UserControl.ContentTemplate>

    <UserControl.Styles>
        <Style Selector="TextBox, DropDownButton, SplitButton, ComboBox, Button, ProgressBar, Label">
            <Setter Property="Margin" Value="2" />
            <Setter Property="HorizontalAlignment" Value="Stretch" />
            <Setter Property="VerticalAlignment" Value="Stretch" />
        </Style>
        <Style Selector="TabControl">
            <Setter Property="Margin" Value="8" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch"></Setter>
            <Setter Property="VerticalContentAlignment" Value="Stretch"></Setter>
        </Style>
    </UserControl.Styles>

    <Grid Name="ContainerGrid" Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"></RowDefinition>
            <RowDefinition Height="16*"></RowDefinition>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"></ColumnDefinition>
            <ColumnDefinition Width="Auto"></ColumnDefinition>
            <ColumnDefinition Width="*"></ColumnDefinition>
        </Grid.ColumnDefinitions>

        <Grid Name="RequestPropertyGrid"
              VerticalAlignment="Stretch"
              HorizontalAlignment="Stretch">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"></ColumnDefinition>
                <ColumnDefinition Width="*"></ColumnDefinition>
            </Grid.ColumnDefinitions>

            <ComboBox Grid.Column="0"
                      Name="RequestMethodBox"
                      Width="130"
                      MaxWidth="130"
                      MinWidth="130"
                      SelectedItem="{Binding SelectedMethod, Mode=TwoWay}"
                      ItemsSource="{Binding Methods}">
                <ComboBox.ItemTemplate>
                    <DataTemplate DataType="rest:Method">
                        <Label Theme="{DynamicResource TitleLabel}"
                               Foreground="{Binding ., Converter={StaticResource MethodEnumToColourConverter}}"
                               Classes="H6"
                               FontWeight="UltraBlack"
                               
                               Content="{Binding ., Converter={StaticResource EnumToUppercaseStringConverter}}" />
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>

            <TextBox Grid.Column="1"
                     Watermark="https://api.example.com/get"
                     Text="{Binding RequestUri, Mode=TwoWay}">
                <TextBox.InnerLeftContent>
                    <PathIcon Data="{StaticResource SemiIconChainStroked}"
                              Height="16"
                              Width="16" />
                </TextBox.InnerLeftContent>
                <TextBox.InnerRightContent>
                    <Button Theme="{DynamicResource BorderlessButton}"
                            Command="{Binding SendRequestCommand}"
                            IsEnabled="{Binding !SendRequestCommand.IsRunning}"
                            Margin="0"
                            Cursor="Arrow">
                        <PathIcon Data="{StaticResource SemiIconSend}"
                                  Foreground="{Binding SelectedMethod, Converter={StaticResource MethodEnumToColourConverter}}"
                                  Height="16"
                                  Width="16" />
                    </Button>
                </TextBox.InnerRightContent>
                <TextBox.Styles>
                    <Style Selector="TextBox /template/ DataValidationErrors">
                        <Setter Property="Theme" Value="{DynamicResource TooltipDataValidationErrors}" />
                    </Style>
                </TextBox.Styles>
                <DataValidationErrors.Error>
                    <system:Exception />
                </DataValidationErrors.Error>
            </TextBox>
        </Grid>
        <TabControl Grid.Column="0" Name="RequestTabControl"
                    Grid.Row="1">
            <TabItem Header="Parameters">
                <controls:ParameterDataGrid Parameters="{Binding RequestParameters, Mode=TwoWay}"
                                            DeleteCommand="{Binding RemoveParameterCommand}"
                                            AddCommand="{Binding AddParameterRowCommand}"
                                            HorizontalAlignment="Stretch" />
            </TabItem>
            <TabItem Header="Auth">
                <Label Content="To be implemented"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center" />
            </TabItem>
            <TabItem Header="Headers">
                <controls:ParameterDataGrid Parameters="{Binding RequestHeaders, Mode=TwoWay}"
                                            DeleteCommand="{Binding RemoveHeaderCommand}"
                                            AddCommand="{Binding AddHeaderRowCommand}" />
            </TabItem>
            <TabItem Header="Body">
                <avaloniaEdit:TextEditor DockPanel.Dock="Bottom"
                                         Document="{Binding RequestDocument}"
                                         Name="RequestBodyEditor"
                                         ShowLineNumbers="True"
                                         FontFamily="Cascadia Code,Consolas,Menlo,Monospace" />
            </TabItem>
            <TabItem Header="Options">
                <StackPanel>
                    <Label Content="To be implemented"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center" />
                </StackPanel>

            </TabItem>
        </TabControl>

        <GridSplitter Grid.Column="1"
                      Grid.Row="1"
                      Margin="4"
                      ResizeDirection="Columns">
        </GridSplitter>

        <Canvas Grid.Row="0"
                Grid.RowSpan="2"
                Grid.Column="2">
            <StackPanel Canvas.Right="0"
                        Canvas.Top="2"
                        IsHitTestVisible="False"
                        Orientation="Horizontal">

                <ProgressBar
                    Width="20"
                    Height="20"
                    BorderThickness="2"
                    Theme="{DynamicResource ProgressRing}"
                    IsVisible="{Binding SendRequestCommand.IsRunning}"
                    IsIndeterminate="True" />
                <Separator VerticalAlignment="Stretch"
                           IsVisible="{Binding SendRequestCommand.IsRunning}" />

                <StackPanel Orientation="Horizontal"
                            IsVisible="{Binding HasResponse}">
                    <Label Theme="{DynamicResource TagLabel}"
                           Content="{Binding ElapsedMilliseconds}"
                           IsHitTestVisible="False" />
                    <Separator VerticalAlignment="Stretch"></Separator>
                    <Label Theme="{DynamicResource TagLabel}"
                           Classes.Green="{Binding IsSuccess}"
                           Classes.Red="{Binding !IsSuccess}"
                           Content="{Binding StatusCode, Converter={StaticResource DefaultEnumToStringPresentationConverter}}"
                           IsHitTestVisible="False" />
                </StackPanel>

            </StackPanel>
        </Canvas>

        <TabControl Name="ResponseTabControl"
                    Grid.Row="0"
                    Grid.RowSpan="2"
                    Grid.Column="2">

            <TabItem Name="ResponseTab"
                     Header="Response">
                <avaloniaEdit:TextEditor DockPanel.Dock="Bottom"
                                         Document="{Binding ResponseDocument}"
                                         Name="ResponseEditor"
                                         ShowLineNumbers="True"
                                         FontFamily="Cascadia Code,Consolas,Menlo,Monospace" />
            </TabItem>
            <TabItem Name="ResponseHeadersTab"
                     Header="Headers">
                <DataGrid ItemsSource="{Binding ResponseHeaders}"
                          IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Width="*"
                                            Header="Name"
                                            Binding="{Binding Name}" />
                        <DataGridTextColumn Width="*"
                                            Header="Value"
                                            Binding="{Binding Value}" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>
        </TabControl>

    </Grid>
</UserControl>